<?php

require_once __DIR__ . '/../vendor/autoload.php';

use App\Services\Database;

$db = Database::getInstance();

try {
    $db->execute("
        CREATE TABLE IF NOT EXISTS users (
            id INT AUTO_INCREMENT PRIMARY KEY,
            name VARCHAR(100) NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            INDEX idx_name (name)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
    ");
    
    $db->execute("
        CREATE TABLE IF NOT EXISTS orders (
            id INT AUTO_INCREMENT PRIMARY KEY,
            title VARCHAR(200) NOT NULL,
            cost DECIMAL(10,2) NOT NULL,
            user_id INT NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
            INDEX idx_user_id (user_id),
            INDEX idx_cost (cost)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
    ");
    
    $db->execute("DELETE FROM orders");
    $db->execute("DELETE FROM users");
    $db->execute("ALTER TABLE users AUTO_INCREMENT = 1");
    $db->execute("ALTER TABLE orders AUTO_INCREMENT = 1");
    
    $users = [
        'Александр Иванов',
        'Дмитрий Смирнов',
        'Михаил Кузнецов',
        'Андрей Попов',
        'Сергей Васильев',
        'Владимир Петров',
        'Алексей Соколов',
        'Игорь Михайлов',
        'Николай Новиков',
        'Павел Федоров',
        'Евгений Морозов',
        'Константин Волков',
        'Роман Алексеев',
        'Виктор Лебедев',
        'Олег Семенов',
        'Юрий Егоров',
        'Василий Павлов',
        'Иван Козлов',
        'Максим Степанов',
        'Антон Николаев',
        'Геннадий Орлов',
        'Денис Андреев',
        'Тимофей Макаров',
        'Борис Захаров',
        'Станислав Яковлев',
        'Валерий Григорьев',
        'Артем Романов',
        'Григорий Воробьев',
        'Виталий Сергеев',
        'Аркадий Кузьмин',
        'Вячеслав Фомин',
        'Леонид Дмитриев',
        'Эдуард Богданов',
        'Семен Коновалов',
        'Вадим Ефимов',
        'Петр Носов',
        'Федор Жуков',
        'Степан Поляков',
        'Ярослав Цветков',
        'Даниил Данилов',
        'Анатолий Журавлев',
        'Руслан Шестаков',
        'Матвей Борисов',
        'Глеб Королев',
        'Захар Герасимов',
        'Тарас Павловский',
        'Всеволод Беляев',
        'Ростислав Мельников',
        'Егор Кириллов',
        'Филипп Панфилов',
        'Валентин Ковалев',
        'Иннокентий Антонов',
        'Прохор Ильин',
        'Арсений Зайцев',
        'Святослав Савельев',
        'Марк Рыбаков',
        'Лука Суханов',
        'Кирилл Титов',
        'Владислав Баранов',
        'Платон Филиппов',
        'Георгий Комаров',
        'Альберт Дементьев',
        'Аркадий Хохлов',
        'Емельян Фролов',
        'Игнат Наумов',
        'Лев Потапов',
        'Родион Жданов',
        'Никита Власов',
        'Владлен Игнатьев',
        'Савва Савин',
        'Мирон Рогов',
        'Серафим Лазарев',
        'Трофим Медведев',
        'Юлиан Ершов',
        'Илья Тихонов',
        'Афанасий Афанасьев',
        'Давид Никитин',
        'Порфирий Соболев',
        'Карп Родионов',
        'Альфред Белов',
        'Адам Щербаков',
        'Изяслав Блинов',
        'Эрик Колесников',
        'Остап Карпов',
        'Антон Абрамов',
        'Назар Марков',
        'Соломон Чернов',
        'Вениамин Шилов',
        'Ипполит Казаков',
        'Ефим Ефремов',
        'Исаак Архипов',
        'Лаврентий Громов',
        'Кузьма Федин',
    ];

    $userIds = [];
    
    foreach ($users as $name) {
        $db->execute("INSERT INTO users (name) VALUES (?)", [$name]);
        $userIds[] = $db->lastInsertId();
    }
    
    $orders = [
        ['Академия здоровья детский санаторий', 78, $userIds[0]],
        ['Алеся санаторий', 121, $userIds[1]],
        ['Альфа-Радон санаторий', 93, $userIds[2]],
        ['Белая вежа санаторий', 145, $userIds[3]],
        ['Белая Русь санаторий', 67, $userIds[4]],
        ['Белорусочка санаторий', 112, $userIds[5]],
        ['Березина санаторий', 88, $userIds[6]],
        ['Березина-Борисов санаторий', 134, $userIds[7]],
        ['Березка санаторий', 56, $userIds[8]],
        ['Берестье (Брестагроздравница) санаторий', 99, $userIds[9]],
        ['Боровое санаторий', 142, $userIds[10]],
        ['Буг санаторий', 71, $userIds[11]],
        ['Василёк санаторий', 128, $userIds[12]],
        ['Веста санаторий', 62, $userIds[13]],
        ['Ветразь ДРОЦ', 105, $userIds[14]],
        ['Волма санаторий', 149, $userIds[15]],
        ['Вяжути санаторий', 84, $userIds[16]],
        ['Дубровенка санаторий', 117, $userIds[17]],
        ['Дудинка оздоровительный центр', 52, $userIds[18]],
        ['Ждановичи ДРОЦ', 139, $userIds[19]],
        ['Железнодорожник санаторий', 76, $userIds[20]],
        ['Жемчужина ДРОЦ', 123, $userIds[21]],
        ['Жемчужина санаторий', 91, $userIds[22]],
        ['Жемчужина (корпус №7 ДРОЦ) санаторий', 147, $userIds[23]],
        ['Журавушка санаторий', 65, $userIds[24]],
        ['Зеленый бор санаторий', 110, $userIds[25]],
        ['Золотые пески санаторий', 86, $userIds[26]],
        ['Им. В.И. Ленина санаторий', 132, $userIds[27]],
        ['Им. К.П. Орловского санаторий', 58, $userIds[28]],
        ['Ислочь санаторий', 97, $userIds[29]],
        ['Колос ДРОЦ', 140, $userIds[30]],
        ['Криница санаторий', 73, $userIds[31]],
        ['Лепельский военный санаторий', 126, $userIds[32]],
        ['Лесная поляна ДРОЦ', 60, $userIds[33]],
        ['Лесное санаторий', 103, $userIds[34]],
        ['Лесные озера санаторий', 148, $userIds[35]],
        ['Лётцы санаторий', 82, $userIds[36]],
        ['Магистральный санаторий', 119, $userIds[37]],
        ['Машиностроитель санаторий', 54, $userIds[38]],
        ['Надежда ДРОЦ', 137, $userIds[39]],
        ['Надзея санаторий', 79, $userIds[40]],
        ['Нарочанка санаторий', 124, $userIds[41]],
        ['Нарочанский берег (корпус санатория Нарочь) санаторий', 92, $userIds[42]],
        ['Нарочь санаторий', 146, $userIds[43]],
        ['Нафтан санаторий', 63, $userIds[44]],
        ['Неман-72 санаторий', 108, $userIds[45]],
        ['Огонёк оздоровительный комплекс', 85, $userIds[46]],
        ['Озёрный санаторий', 130, $userIds[47]],
        ['Плисса санаторий', 57, $userIds[48]],
        ['Подъельники санаторий', 100, $userIds[49]],
        ['Поречье санаторий', 143, $userIds[50]],
        ['Пралеска санаторий', 69, $userIds[51]],
        ['Пралеска санаторий', 125, $userIds[52]],
        ['Приднепровский санаторий', 90, $userIds[53]],
        ['Приморский санаторий', 144, $userIds[54]],
        ['Приозерный санаторий', 66, $userIds[55]],
        ['Радон санаторий', 111, $userIds[56]],
        ['Радуга санаторий', 87, $userIds[57]],
        ['Радуга детский санаторий', 133, $userIds[58]],
        ['Ракета оздоровительный комплекс', 59, $userIds[59]],
        ['Рассвет - Любань санаторий', 98, $userIds[60]],
        ['Республиканская больница спелеолечения', 141, $userIds[61]],
        ['РНПЦ медэкспертизы и реабилитации', 72, $userIds[62]],
        ['Росинка детский санаторий', 127, $userIds[63]],
        ['РУП Гомельское отд. БЖД санаторий', 61, $userIds[64]],
        ['Рудня санаторий', 104, $userIds[65]],
        ['Ружанский санаторий', 150, $userIds[66]],
        ['Свитанак ДРОЦ', 81, $userIds[67]],
        ['Свитанок санаторий', 120, $userIds[68]],
        ['Свитязь санаторий', 55, $userIds[69]],
        ['Серебряные ключи санаторий', 136, $userIds[70]],
        ['Сидельники ДРОЦ', 77, $userIds[71]],
        ['Силичи РГЦ', 122, $userIds[72]],
        ['Солнечный санаторий', 94, $userIds[73]],
        ['Солнышко детский санаторий', 138, $userIds[74]],
        ['Сосновый бор оздоровительный комплекс', 64, $userIds[75]],
        ['Сосновый бор санаторий', 107, $userIds[76]],
        ['Сосны санаторий', 83, $userIds[77]],
        ['Сосны санаторий', 129, $userIds[78]],
        ['Сосны санаторий', 51, $userIds[79]],
        ['Спутник санаторий', 96, $userIds[80]],
        ['Талька оздоровительный центр', 142, $userIds[81]],
        ['Центр медицинской реабилитации и бальнеолечения', 75, $userIds[82]],
        ['Чаборок санаторий', 118, $userIds[83]],
        ['Чайка санаторий', 53, $userIds[84]],
        ['Чёнки санаторий', 135, $userIds[85]],
        ['Шинник санаторий', 80, $userIds[86]],
        ['Энергетик санаторий', 123, $userIds[87]],
        ['Энергетик санаторий', 95, $userIds[88]],
        ['Энергетик оздоровительный центр', 140, $userIds[89]],
        ['Энергия оздоровительный центр', 68, $userIds[90]],
        ['Юность санаторий', 113, $userIds[91]],
        ['Юрцево областной госпиталь', 89, $userIds[92]]
    ];
    
    foreach ($orders as $order) {
        $db->execute(
            "INSERT INTO orders (title, cost, user_id) VALUES (?, ?, ?)",
            $order
        );
    }
    
    echo "База данных успешно инициализирована\n";
    echo "Пользователей: " . count($users) . "\n";
    echo "Заказов: " . count($orders) . "\n";
    
} catch (Exception $e) {
    echo "Ошибка: " . $e->getMessage() . "\n";
    exit(1);
}